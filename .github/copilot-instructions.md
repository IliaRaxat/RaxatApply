**Overview**

This repo is an HH.ru auto-parser + auto-applicant built with Puppeteer and a small SQLite DB. Main flow:
- `parser.js` — crawls HH search result pages (uses `items_on_page=100`) and saves vacancies to `db/main.db`.
- `filter.js` — calculates relevance using keywords from `config.search.keywords` and returns boolean suitability.
- `applicator.js` — opens vacancy `response_url`, fills survey/questions, generates/uses a cover letter and submits the application.
- `cover_letter_generator.js` — calls Gemini (`@google/genai`) using keys from `config.geminiApiKeys`.
- `database.js` — SQLite schema: `vacancies`, `vacancy_details`, `survey_answers` (see file for columns).
- `main.js` — orchestrates: runs parser for all `config.search.queries` × `config.search.areas`, then picks top-350 `new` vacancies by relevance and applies.

**How to run (dev)**
- Run the app directly: `node main.js` from repository root.
- DB file: `./db/main.db` (SQLite). Use `node clear_db.js` to reset if needed.

**Key configuration points (edit these first)**
- `config.js`:
  - `search.queries` — array of queries. Each item can be `{ type: 'text', value: '...' }` or `{ type: 'resume_based', resumeId: '...' }`.
  - `search.areas` — region IDs (e.g. `113` = whole Russia).
  - `search.keywords` — keyword objects `{ word, weight }` used by `filter.calculateVacancyRelevance`.
  - `puppeteer.headless` and `puppeteer.slowMo` control browser behavior.
  - `delays` — all global delays are read from `config.delays` (used in both `parser.js` and `applicator.js`). To remove delays, set these to `0`.

**Where the resume and cover letters live**
- Current resume text is embedded in `applicator.js` as the `resumeContent` constant (search for the big Russian text block). To update resume keywords or let AI use it, edit that block or refactor to read from a file/database.
- Cover letters are generated by `cover_letter_generator.js` (Gemini) and then saved to DB via `updateVacancyCoverLetter` in `database.js`.

**Exactly 350 applications**
- `main.js` already selects the top 350 vacancies with `vacanciesWithScore.slice(0, 350)` and then filters them by `isVacancySuitable` before applying.
- Important implications:
  - Ensure parser collects enough `new` vacancies (increase `queries` / `areas` or remove aggressive filtering during parse).
  - To guarantee 350 applications, adjust where filtering happens. If you want exactly 350 attempts regardless of filter, change `main.js` to pick 350 after filtering or remove the `isVacancySuitable` filter.

**Delays & rate-limiting**
- Delays controlled via `config.delays` and inline `delay(...)` calls. To remove delays set all `config.delays` entries to `0`.
- HH.ru rate limit detection is implemented in `applicator.js` (search for `rate_limit_exceeded` and message text). On rate limit it sets DB status `rate_limited` and `main.js` pauses ~25 hours.

**AI / Gemini usage**
- `cover_letter_generator.js` uses `@google/genai`. API keys are provided in `config.geminiApiKeys`. The generator implements retries on 503.
- If Gemini quota is exhausted, `main.js` and `applicator.js` set status `gemini_quota_exceeded` and pause the cycle.

**Patterns & conventions to follow when modifying code**
- Small utilities are centralized in `puppeteerUtils.js` (click/type wrappers with retries) — reuse them rather than raw `page.click`.
- DB modifications should go through `database.js` functions (`addVacancy`, `saveVacancyDetails`, `updateVacancyCoverLetter`).
- Relevance scoring uses `config.search.keywords` and bonuses in `filter.js`. If you add keywords programmatically, update both `config.js` and ensure `filter.calculateVacancyRelevance` can consume them.

**Troubleshooting tips**
- If parser finds too few vacancies: check `parser.js` using `items_on_page=100` and page count detection; ensure `config.search.queries` are correct.
- If applications stall or fail: check `config.cookies` (HHTOKEN/XSRF), and review `applicator.js` logs — it has detailed fallback attempts.
- To change resume-derived keywords: edit the embedded resume in `applicator.js` or implement reading from an external `resume.txt` and update `config.search.keywords` accordingly.

**Contributors / next steps for agents**
- If asked to remove delays and always include a cover letter, modify `config.delays` to zeros and ensure `applicator.js` always calls `generateCoverLetter` before submit (it already saves to DB and attempts to fill `textarea` where present).
- If asked to make resume-driven queries (collect vacancies based on resume), use `config.search.queries` with `type: 'resume_based'` and `resumeId` as shown in `config.js` comments.

If anything above is unclear or you want me to also implement the runtime changes (remove delays, read resume from file, ensure exactly 350 attempts), tell me which change to make first and I will apply it and run quick checks.
